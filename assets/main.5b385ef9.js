let P;async function G(){return P===void 0&&(P=F()),P}async function F(){return J(await WA.room.getTiledMap())}function J(n){const e=new Map;return q(n.layers,"",e),e}function q(n,e,t){for(const r of n)r.type==="group"?q(r.layers,e+r.name+"/",t):(r.name=e+r.name,t.set(r.name,r))}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var $=Object.prototype.toString,S=Array.isArray||function(e){return $.call(e)==="[object Array]"};function U(n){return typeof n=="function"}function x(n){return S(n)?"array":typeof n}function L(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function O(n,e){return n!=null&&typeof n=="object"&&e in n}function z(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var B=RegExp.prototype.test;function D(n,e){return B.call(n,e)}var H=/\S/;function K(n){return!D(H,n)}var Q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function V(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Q[t]})}var X=/\s*/,Y=/\s+/,_=/\s*=/,Z=/\s*\}/,ee=/#|\^|\/|>|\{|&|=|!/;function re(n,e){if(!n)return[];var t=!1,r=[],s=[],a=[],i=!1,o=!1,u="",c=0;function p(){if(i&&!o)for(;a.length;)delete s[a.pop()];else a=[];i=!1,o=!1}var y,b,j;function I(g){if(typeof g=="string"&&(g=g.split(Y,2)),!S(g)||g.length!==2)throw new Error("Invalid tags: "+g);y=new RegExp(L(g[0])+"\\s*"),b=new RegExp("\\s*"+L(g[1])),j=new RegExp("\\s*"+L("}"+g[1]))}I(e||d.tags);for(var l=new R(n),w,h,v,A,k,E;!l.eos();){if(w=l.pos,v=l.scanUntil(y),v)for(var T=0,N=v.length;T<N;++T)A=v.charAt(T),K(A)?(a.push(s.length),u+=A):(o=!0,t=!0,u+=" "),s.push(["text",A,w,w+1]),w+=1,A===`
`&&(p(),u="",c=0,t=!1);if(!l.scan(y))break;if(i=!0,h=l.scan(ee)||"name",l.scan(X),h==="="?(v=l.scanUntil(_),l.scan(_),l.scanUntil(b)):h==="{"?(v=l.scanUntil(j),l.scan(Z),l.scanUntil(b),h="&"):v=l.scanUntil(b),!l.scan(b))throw new Error("Unclosed tag at "+l.pos);if(h==">"?k=[h,v,w,l.pos,u,c,t]:k=[h,v,w,l.pos],c++,s.push(k),h==="#"||h==="^")r.push(k);else if(h==="/"){if(E=r.pop(),!E)throw new Error('Unopened section "'+v+'" at '+w);if(E[1]!==v)throw new Error('Unclosed section "'+E[1]+'" at '+w)}else h==="name"||h==="{"||h==="&"?o=!0:h==="="&&I(v)}if(p(),E=r.pop(),E)throw new Error('Unclosed section "'+E[1]+'" at '+l.pos);return ne(te(s))}function te(n){for(var e=[],t,r,s=0,a=n.length;s<a;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function ne(n){for(var e=[],t=e,r=[],s,a,i=0,o=n.length;i<o;++i)switch(s=n[i],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":a=r.pop(),a[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function R(n){this.string=n,this.tail=n,this.pos=0}R.prototype.eos=function(){return this.tail===""};R.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};R.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function C(n,e){this.view=n,this.cache={".":this.view},this.parent=e}C.prototype.push=function(e){return new C(e,this)};C.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,a,i,o,u=!1;s;){if(e.indexOf(".")>0)for(a=s.view,i=e.split("."),o=0;a!=null&&o<i.length;)o===i.length-1&&(u=O(a,i[o])||z(a,i[o])),a=a[i[o++]];else a=s.view[e],u=O(s.view,e);if(u){r=a;break}s=s.parent}t[e]=r}return U(r)&&(r=r.call(this.view)),r};function f(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}f.prototype.clearCache=function(){typeof this.templateCache!="undefined"&&this.templateCache.clear()};f.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||d.tags).join(":"),a=typeof r!="undefined",i=a?r.get(s):void 0;return i==null&&(i=re(e,t),a&&r.set(s,i)),i};f.prototype.render=function(e,t,r,s){var a=this.getConfigTags(s),i=this.parse(e,a),o=t instanceof C?t:new C(t,void 0);return this.renderTokens(i,o,r,e,s)};f.prototype.renderTokens=function(e,t,r,s,a){for(var i="",o,u,c,p=0,y=e.length;p<y;++p)c=void 0,o=e[p],u=o[0],u==="#"?c=this.renderSection(o,t,r,s,a):u==="^"?c=this.renderInverted(o,t,r,s,a):u===">"?c=this.renderPartial(o,t,r,a):u==="&"?c=this.unescapedValue(o,t):u==="name"?c=this.escapedValue(o,t,a):u==="text"&&(c=this.rawValue(o)),c!==void 0&&(i+=c);return i};f.prototype.renderSection=function(e,t,r,s,a){var i=this,o="",u=t.lookup(e[1]);function c(b){return i.render(b,t,r,a)}if(!!u){if(S(u))for(var p=0,y=u.length;p<y;++p)o+=this.renderTokens(e[4],t.push(u[p]),r,s,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,s,a);else if(U(u)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,s.slice(e[3],e[5]),c),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,s,a);return o}};f.prototype.renderInverted=function(e,t,r,s,a){var i=t.lookup(e[1]);if(!i||S(i)&&i.length===0)return this.renderTokens(e[4],t,r,s,a)};f.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),a=e.split(`
`),i=0;i<a.length;i++)a[i].length&&(i>0||!r)&&(a[i]=s+a[i]);return a.join(`
`)};f.prototype.renderPartial=function(e,t,r,s){if(!!r){var a=this.getConfigTags(s),i=U(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],u=e[5],c=e[4],p=i;u==0&&c&&(p=this.indentPartial(i,c,o));var y=this.parse(p,a);return this.renderTokens(y,t,r,p,s)}}};f.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};f.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||d.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&s===d.escape?String(a):s(a)};f.prototype.rawValue=function(e){return e[1]};f.prototype.getConfigTags=function(e){return S(e)?e:e&&typeof e=="object"?e.tags:void 0};f.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!S(e))return e.escape};var d={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){W.templateCache=n},get templateCache(){return W.templateCache}},W=new f;d.clearCache=function(){return W.clearCache()};d.parse=function(e,t){return W.parse(e,t)};d.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+x(e)+'" was given as the first argument for mustache#render(template, view, partials)');return W.render(e,t,r,s)};d.escape=V;d.Scanner=R;d.Context=C;d.Writer=f;function M(n){var e;if(n)try{(e=window==null?void 0:window.top)==null||e.postMessage(n,"*")}catch(t){console.error("Enable to send message to main window. ",JSON.stringify(n),t)}}console.log("Script started successfully");let m;WA.onInit().then(async()=>{let n=await G();console.log("Current player name : ",WA.player.name),console.log(n),n.forEach((e,t)=>{e&&e.properties&&e.properties.forEach(r=>{if(r.name==="goto"){console.log("GotoLayer : "+t);let s;try{s=JSON.parse(r.value)}catch{}s&&WA.room.onEnterLayer(t).subscribe(()=>{s!=null&&s.confirmMessage?(m&&m.remove(),m=WA.ui.displayActionMessage({message:s.confirmMessage,type:"message",callback:()=>M(s)})):M(s)}),s!=null&&s.confirmMessage&&WA.room.onLeaveLayer(t).subscribe(()=>{m&&(m.remove(),m=void 0)})}else r.type==="string"&&r.name==="openTeam"?WA.room.onEnterLayer(t).subscribe(()=>{WA.ui.displayActionMessage({message:"press 'space' to start",callback:()=>{WA.nav.openCoWebSite("https://meet.google.com/kzd-kime-iau",!0,"*",70,1,!0,!0)}})}):r.type==="string"&&r.name==="jitsiRoom"&&(WA.room.onEnterLayer(t).subscribe(()=>{M({action:"visio",type:"jitsi",value:r.value})}),WA.room.onLeaveLayer(t).subscribe(()=>{M({action:"visio",type:"jitsi",value:"_leave"})}))})})}).catch(n=>console.error(n));
