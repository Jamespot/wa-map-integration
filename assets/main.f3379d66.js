let P;async function G(){return P===void 0&&(P=F()),P}async function F(){return J(await WA.room.getTiledMap())}function J(n){const e=new Map;return q(n.layers,"",e),e}function q(n,e,t){for(const r of n)r.type==="group"?q(r.layers,e+r.name+"/",t):(r.name=e+r.name,t.set(r.name,r))}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var $=Object.prototype.toString,S=Array.isArray||function(e){return $.call(e)==="[object Array]"};function U(n){return typeof n=="function"}function x(n){return S(n)?"array":typeof n}function L(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function O(n,e){return n!=null&&typeof n=="object"&&e in n}function B(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var D=RegExp.prototype.test;function H(n,e){return D.call(n,e)}var K=/\S/;function z(n){return!H(K,n)}var Q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function V(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Q[t]})}var X=/\s*/,Y=/\s+/,_=/\s*=/,Z=/\s*\}/,ee=/#|\^|\/|>|\{|&|=|!/;function re(n,e){if(!n)return[];var t=!1,r=[],a=[],s=[],i=!1,o=!1,c="",u=0;function p(){if(i&&!o)for(;s.length;)delete a[s.pop()];else s=[];i=!1,o=!1}var y,b,j;function I(g){if(typeof g=="string"&&(g=g.split(Y,2)),!S(g)||g.length!==2)throw new Error("Invalid tags: "+g);y=new RegExp(L(g[0])+"\\s*"),b=new RegExp("\\s*"+L(g[1])),j=new RegExp("\\s*"+L("}"+g[1]))}I(e||d.tags);for(var l=new W(n),w,h,v,A,T,E;!l.eos();){if(w=l.pos,v=l.scanUntil(y),v)for(var k=0,N=v.length;k<N;++k)A=v.charAt(k),z(A)?(s.push(a.length),c+=A):(o=!0,t=!0,c+=" "),a.push(["text",A,w,w+1]),w+=1,A===`
`&&(p(),c="",u=0,t=!1);if(!l.scan(y))break;if(i=!0,h=l.scan(ee)||"name",l.scan(X),h==="="?(v=l.scanUntil(_),l.scan(_),l.scanUntil(b)):h==="{"?(v=l.scanUntil(j),l.scan(Z),l.scanUntil(b),h="&"):v=l.scanUntil(b),!l.scan(b))throw new Error("Unclosed tag at "+l.pos);if(h==">"?T=[h,v,w,l.pos,c,u,t]:T=[h,v,w,l.pos],u++,a.push(T),h==="#"||h==="^")r.push(T);else if(h==="/"){if(E=r.pop(),!E)throw new Error('Unopened section "'+v+'" at '+w);if(E[1]!==v)throw new Error('Unclosed section "'+E[1]+'" at '+w)}else h==="name"||h==="{"||h==="&"?o=!0:h==="="&&I(v)}if(p(),E=r.pop(),E)throw new Error('Unclosed section "'+E[1]+'" at '+l.pos);return ne(te(a))}function te(n){for(var e=[],t,r,a=0,s=n.length;a<s;++a)t=n[a],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function ne(n){for(var e=[],t=e,r=[],a,s,i=0,o=n.length;i<o;++i)switch(a=n[i],a[0]){case"#":case"^":t.push(a),r.push(a),t=a[4]=[];break;case"/":s=r.pop(),s[5]=a[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(a)}return e}function W(n){this.string=n,this.tail=n,this.pos=0}W.prototype.eos=function(){return this.tail===""};W.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};W.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function C(n,e){this.view=n,this.cache={".":this.view},this.parent=e}C.prototype.push=function(e){return new C(e,this)};C.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var a=this,s,i,o,c=!1;a;){if(e.indexOf(".")>0)for(s=a.view,i=e.split("."),o=0;s!=null&&o<i.length;)o===i.length-1&&(c=O(s,i[o])||B(s,i[o])),s=s[i[o++]];else s=a.view[e],c=O(a.view,e);if(c){r=s;break}a=a.parent}t[e]=r}return U(r)&&(r=r.call(this.view)),r};function f(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}f.prototype.clearCache=function(){typeof this.templateCache!="undefined"&&this.templateCache.clear()};f.prototype.parse=function(e,t){var r=this.templateCache,a=e+":"+(t||d.tags).join(":"),s=typeof r!="undefined",i=s?r.get(a):void 0;return i==null&&(i=re(e,t),s&&r.set(a,i)),i};f.prototype.render=function(e,t,r,a){var s=this.getConfigTags(a),i=this.parse(e,s),o=t instanceof C?t:new C(t,void 0);return this.renderTokens(i,o,r,e,a)};f.prototype.renderTokens=function(e,t,r,a,s){for(var i="",o,c,u,p=0,y=e.length;p<y;++p)u=void 0,o=e[p],c=o[0],c==="#"?u=this.renderSection(o,t,r,a,s):c==="^"?u=this.renderInverted(o,t,r,a,s):c===">"?u=this.renderPartial(o,t,r,s):c==="&"?u=this.unescapedValue(o,t):c==="name"?u=this.escapedValue(o,t,s):c==="text"&&(u=this.rawValue(o)),u!==void 0&&(i+=u);return i};f.prototype.renderSection=function(e,t,r,a,s){var i=this,o="",c=t.lookup(e[1]);function u(b){return i.render(b,t,r,s)}if(!!c){if(S(c))for(var p=0,y=c.length;p<y;++p)o+=this.renderTokens(e[4],t.push(c[p]),r,a,s);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")o+=this.renderTokens(e[4],t.push(c),r,a,s);else if(U(c)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(t.view,a.slice(e[3],e[5]),u),c!=null&&(o+=c)}else o+=this.renderTokens(e[4],t,r,a,s);return o}};f.prototype.renderInverted=function(e,t,r,a,s){var i=t.lookup(e[1]);if(!i||S(i)&&i.length===0)return this.renderTokens(e[4],t,r,a,s)};f.prototype.indentPartial=function(e,t,r){for(var a=t.replace(/[^ \t]/g,""),s=e.split(`
`),i=0;i<s.length;i++)s[i].length&&(i>0||!r)&&(s[i]=a+s[i]);return s.join(`
`)};f.prototype.renderPartial=function(e,t,r,a){if(!!r){var s=this.getConfigTags(a),i=U(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],c=e[5],u=e[4],p=i;c==0&&u&&(p=this.indentPartial(i,u,o));var y=this.parse(p,s);return this.renderTokens(y,t,r,p,a)}}};f.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};f.prototype.escapedValue=function(e,t,r){var a=this.getConfigEscape(r)||d.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&a===d.escape?String(s):a(s)};f.prototype.rawValue=function(e){return e[1]};f.prototype.getConfigTags=function(e){return S(e)?e:e&&typeof e=="object"?e.tags:void 0};f.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!S(e))return e.escape};var d={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){R.templateCache=n},get templateCache(){return R.templateCache}},R=new f;d.clearCache=function(){return R.clearCache()};d.parse=function(e,t){return R.parse(e,t)};d.render=function(e,t,r,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+x(e)+'" was given as the first argument for mustache#render(template, view, partials)');return R.render(e,t,r,a)};d.escape=V;d.Scanner=W;d.Context=C;d.Writer=f;function M(n){var e;if(n)try{(e=window==null?void 0:window.top)==null||e.postMessage(n,"*")}catch(t){console.error("Enable to send message to main window. ",JSON.stringify(n),t)}}console.log("Script started successfully");let m;WA.onInit().then(async()=>{let n=await G();console.log("Current player name : ",WA.player.name),console.log(n),n.forEach((e,t)=>{e&&e.properties&&e.properties.forEach(r=>{if(r.name==="goto"){console.log("GotoLayer : "+t);let a;try{a=JSON.parse(r.value)}catch{}a&&WA.room.onEnterLayer(t).subscribe(()=>{a!=null&&a.confirmMessage?(m&&m.remove(),m=WA.ui.displayActionMessage({message:a.confirmMessage,type:"message",callback:()=>M(a)})):M(a)}),a!=null&&a.confirmMessage&&WA.room.onLeaveLayer(t).subscribe(()=>{m&&(m.remove(),m=void 0)})}else r.type==="string"&&r.name==="openTeam"?WA.room.onEnterLayer(t).subscribe(()=>{WA.ui.displayActionMessage({message:"press 'space' to start",callback:()=>{WA.nav.openTab(r.value)}})}):r.type==="string"&&r.name==="jitsiRoom"&&(WA.room.onEnterLayer(t).subscribe(()=>{M({action:"visio",type:"jitsi",value:r.value})}),WA.room.onLeaveLayer(t).subscribe(()=>{M({action:"visio",type:"jitsi",value:"_leave"})}))})})}).catch(n=>console.error(n));
