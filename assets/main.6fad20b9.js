let P;async function G(){return P===void 0&&(P=F()),P}async function F(){return J(await WA.room.getTiledMap())}function J(n){const e=new Map;return q(n.layers,"",e),e}function q(n,e,t){for(const r of n)r.type==="group"?q(r.layers,e+r.name+"/",t):(r.name=e+r.name,t.set(r.name,r))}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var $=Object.prototype.toString,m=Array.isArray||function(e){return $.call(e)==="[object Array]"};function L(n){return typeof n=="function"}function x(n){return m(n)?"array":typeof n}function U(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function O(n,e){return n!=null&&typeof n=="object"&&e in n}function B(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var D=RegExp.prototype.test;function H(n,e){return D.call(n,e)}var K=/\S/;function z(n){return!H(K,n)}var Q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function V(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Q[t]})}var X=/\s*/,Y=/\s+/,_=/\s*=/,Z=/\s*\}/,ee=/#|\^|\/|>|\{|&|=|!/;function re(n,e){if(!n)return[];var t=!1,r=[],a=[],s=[],i=!1,o=!1,u="",c=0;function p(){if(i&&!o)for(;s.length;)delete a[s.pop()];else s=[];i=!1,o=!1}var y,b,j;function I(g){if(typeof g=="string"&&(g=g.split(Y,2)),!m(g)||g.length!==2)throw new Error("Invalid tags: "+g);y=new RegExp(U(g[0])+"\\s*"),b=new RegExp("\\s*"+U(g[1])),j=new RegExp("\\s*"+U("}"+g[1]))}I(e||d.tags);for(var l=new k(n),w,h,v,R,M,E;!l.eos();){if(w=l.pos,v=l.scanUntil(y),v)for(var W=0,N=v.length;W<N;++W)R=v.charAt(W),z(R)?(s.push(a.length),u+=R):(o=!0,t=!0,u+=" "),a.push(["text",R,w,w+1]),w+=1,R===`
`&&(p(),u="",c=0,t=!1);if(!l.scan(y))break;if(i=!0,h=l.scan(ee)||"name",l.scan(X),h==="="?(v=l.scanUntil(_),l.scan(_),l.scanUntil(b)):h==="{"?(v=l.scanUntil(j),l.scan(Z),l.scanUntil(b),h="&"):v=l.scanUntil(b),!l.scan(b))throw new Error("Unclosed tag at "+l.pos);if(h==">"?M=[h,v,w,l.pos,u,c,t]:M=[h,v,w,l.pos],c++,a.push(M),h==="#"||h==="^")r.push(M);else if(h==="/"){if(E=r.pop(),!E)throw new Error('Unopened section "'+v+'" at '+w);if(E[1]!==v)throw new Error('Unclosed section "'+E[1]+'" at '+w)}else h==="name"||h==="{"||h==="&"?o=!0:h==="="&&I(v)}if(p(),E=r.pop(),E)throw new Error('Unclosed section "'+E[1]+'" at '+l.pos);return ne(te(a))}function te(n){for(var e=[],t,r,a=0,s=n.length;a<s;++a)t=n[a],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function ne(n){for(var e=[],t=e,r=[],a,s,i=0,o=n.length;i<o;++i)switch(a=n[i],a[0]){case"#":case"^":t.push(a),r.push(a),t=a[4]=[];break;case"/":s=r.pop(),s[5]=a[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(a)}return e}function k(n){this.string=n,this.tail=n,this.pos=0}k.prototype.eos=function(){return this.tail===""};k.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};k.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function S(n,e){this.view=n,this.cache={".":this.view},this.parent=e}S.prototype.push=function(e){return new S(e,this)};S.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var a=this,s,i,o,u=!1;a;){if(e.indexOf(".")>0)for(s=a.view,i=e.split("."),o=0;s!=null&&o<i.length;)o===i.length-1&&(u=O(s,i[o])||B(s,i[o])),s=s[i[o++]];else s=a.view[e],u=O(a.view,e);if(u){r=s;break}a=a.parent}t[e]=r}return L(r)&&(r=r.call(this.view)),r};function f(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}f.prototype.clearCache=function(){typeof this.templateCache!="undefined"&&this.templateCache.clear()};f.prototype.parse=function(e,t){var r=this.templateCache,a=e+":"+(t||d.tags).join(":"),s=typeof r!="undefined",i=s?r.get(a):void 0;return i==null&&(i=re(e,t),s&&r.set(a,i)),i};f.prototype.render=function(e,t,r,a){var s=this.getConfigTags(a),i=this.parse(e,s),o=t instanceof S?t:new S(t,void 0);return this.renderTokens(i,o,r,e,a)};f.prototype.renderTokens=function(e,t,r,a,s){for(var i="",o,u,c,p=0,y=e.length;p<y;++p)c=void 0,o=e[p],u=o[0],u==="#"?c=this.renderSection(o,t,r,a,s):u==="^"?c=this.renderInverted(o,t,r,a,s):u===">"?c=this.renderPartial(o,t,r,s):u==="&"?c=this.unescapedValue(o,t):u==="name"?c=this.escapedValue(o,t,s):u==="text"&&(c=this.rawValue(o)),c!==void 0&&(i+=c);return i};f.prototype.renderSection=function(e,t,r,a,s){var i=this,o="",u=t.lookup(e[1]);function c(b){return i.render(b,t,r,s)}if(!!u){if(m(u))for(var p=0,y=u.length;p<y;++p)o+=this.renderTokens(e[4],t.push(u[p]),r,a,s);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,a,s);else if(L(u)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,a.slice(e[3],e[5]),c),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,a,s);return o}};f.prototype.renderInverted=function(e,t,r,a,s){var i=t.lookup(e[1]);if(!i||m(i)&&i.length===0)return this.renderTokens(e[4],t,r,a,s)};f.prototype.indentPartial=function(e,t,r){for(var a=t.replace(/[^ \t]/g,""),s=e.split(`
`),i=0;i<s.length;i++)s[i].length&&(i>0||!r)&&(s[i]=a+s[i]);return s.join(`
`)};f.prototype.renderPartial=function(e,t,r,a){if(!!r){var s=this.getConfigTags(a),i=L(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],u=e[5],c=e[4],p=i;u==0&&c&&(p=this.indentPartial(i,c,o));var y=this.parse(p,s);return this.renderTokens(y,t,r,p,a)}}};f.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};f.prototype.escapedValue=function(e,t,r){var a=this.getConfigEscape(r)||d.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&a===d.escape?String(s):a(s)};f.prototype.rawValue=function(e){return e[1]};f.prototype.getConfigTags=function(e){return m(e)?e:e&&typeof e=="object"?e.tags:void 0};f.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!m(e))return e.escape};var d={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){A.templateCache=n},get templateCache(){return A.templateCache}},A=new f;d.clearCache=function(){return A.clearCache()};d.parse=function(e,t){return A.parse(e,t)};d.render=function(e,t,r,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+x(e)+'" was given as the first argument for mustache#render(template, view, partials)');return A.render(e,t,r,a)};d.escape=V;d.Scanner=k;d.Context=S;d.Writer=f;function T(n){var e;if(n)try{(e=window==null?void 0:window.top)==null||e.postMessage(n,"*")}catch(t){console.error("Enable to send message to main window. ",JSON.stringify(n),t)}}console.log("Script started successfully");let C;WA.onInit().then(async()=>{let n=await G();console.log("Current player name : ",WA.player.name),console.log(n),n.forEach((e,t)=>{e&&e.properties&&e.properties.forEach(r=>{if(r.name==="goto"){console.log("GotoLayer : "+t);let a;try{a=JSON.parse(r.value)}catch{}a&&WA.room.onEnterLayer(t).subscribe(()=>{a!=null&&a.confirmMessage?(C&&C.remove(),C=WA.ui.displayActionMessage({message:a.confirmMessage,type:"message",callback:()=>T(a)})):T(a)}),a!=null&&a.confirmMessage&&WA.room.onLeaveLayer(t).subscribe(()=>{C&&(C.remove(),C=void 0)})}else r.type==="string"&&r.name==="jitsiRoom"&&(WA.room.onEnterLayer(t).subscribe(()=>{T({action:"visio",type:"jitsi",value:r.value})}),WA.room.onLeaveLayer(t).subscribe(()=>{T({action:"visio",type:"jitsi",value:"_leave"})}))})})}).catch(n=>console.error(n));
